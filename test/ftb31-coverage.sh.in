#!/bin/bash
# coverage for FTB 3.1
fsa="@top_builddir@/src/generated/omorfi-ftb3.analyse.hfst"
if ! test -r  $fsa ; then
    echo Unable to find built fsa for tests: $fsa
    exit 77
fi
if test -z $srcdir ; then
    echo invoke from make check or define srcdir=.
    exit 1
fi

if ! test -f ftb3.1.uniq.freqs ; then
    if ! test -f ftb3.1.conllx ; then
        echo "Fetching and unpacking ftb3.1, this may take a while..."
        wget "http://www.ling.helsinki.fi/kieliteknologia/tutkimus/treebank/sources/ftb3.1.conllx.gz"
        gunzip ftb3.1.conllx.gz
    fi
    egrep -v '^<' < ftb3.1.conllx |\
        cut -f 2 |\
        sort | uniq -c | sort -nr > ftb3.1.uniq.freqs
fi

echo Looking up ftb3.1.conllx

if ! @PYTHON@ $srcdir/coverage.py -f $fsa -i ftb3.1.uniq.freqs -c 2 -o ftb3.1.coverage.log -t 96 ; then
    exit 1
fi

